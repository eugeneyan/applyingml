{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/resources/discovery-system-design/",
    "result": {"data":{"mdx":{"frontmatter":{"title":"System Design for Discovery (RecSys and Search)","description":"Breaking it into offline vs. online environments, and candidate retrieval vs. ranking steps.","name":null,"role":null,"slug":"/resources/discovery-system-design/","type":"resource"},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"System Design for Discovery (RecSys and Search)\",\n  \"description\": \"Breaking it into offline vs. online environments, and candidate retrieval vs. ranking steps.\",\n  \"date\": \"2021-06-27\",\n  \"slug\": \"/resources/discovery-system-design/\",\n  \"type\": \"resource\",\n  \"homepage\": true\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"How do the system designs for industrial recommendations and search look like? It\\u2019s uncommon to see system design discussed in machine learning papers or blogs; most focus on model design, training data, and/or loss functions. Nonetheless, the papers that discuss implementation details elucidate design patterns and best practices that are hard to gain outside of hands-on experience.\"), mdx(\"p\", null, \"Specific to discovery systems (i.e., recommendations and search), most implementations I\\u2019ve come across follow a similar paradigm\\u2014components and processes are split into offline vs. online environments, and candidate retrieval vs. ranking steps. The 2 x 2 below tries to simplify this.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.42857142857143%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3lAH/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABPyFf/9oADAMBAAIAAwAAABCgz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQABBAMAAAAAAAAAAAAAAAEAESFBURCh0f/aAAgBAQABPxBW9bWwwz7BddyhANcf/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"2 x 2 of online vs. offline environments, and candidate retrieval vs. ranking.\",\n    \"title\": \"2 x 2 of online vs. offline environments, and candidate retrieval vs. ranking.\",\n    \"src\": \"/static/8f2e54dc219b1e2cdf62e691d2bf171e/29d31/discovery-2x2.jpg\",\n    \"srcSet\": [\"/static/8f2e54dc219b1e2cdf62e691d2bf171e/e52aa/discovery-2x2.jpg 175w\", \"/static/8f2e54dc219b1e2cdf62e691d2bf171e/70ebb/discovery-2x2.jpg 350w\", \"/static/8f2e54dc219b1e2cdf62e691d2bf171e/29d31/discovery-2x2.jpg 700w\", \"/static/8f2e54dc219b1e2cdf62e691d2bf171e/a2510/discovery-2x2.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"2 x 2 of online vs. offline environments, and candidate retrieval vs. ranking.\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"The offline environment\"), \" hosts batch processes such as model training (e.g., representation learning, ranking), creating embeddings for catalog items, and building an approximate nearest neighbors (ANN) index or knowledge graph to find similar items. It may also include loading item and user data into a feature store that is used to augment input data during ranking. \"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"The online environment\"), \" then uses the artifacts generated (e.g., ANN indices, knowledge graphs, models, feature stores) to serve individual requests. A typical approach is converting the input item or search query into an embedding, followed by candidate retrieval and ranking. There are also other preprocessing steps (e.g., standardizing queries, tokenization, spell check) and post-processing steps (e.g., filtering undesirable items, business logic) though we won\\u2019t discuss them in this writeup. \"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Candidate retrieval\"), \" is a fast\\u2014but coarse\\u2014step to narrow down millions of items into hundreds of candidates. We trade off precision for efficiency to quickly narrow the search space (e.g., from millions to hundreds, a 99.99% reduction) for the downstream ranking task. Most contemporary retrieval methods convert the input (i.e., item, search query) into an embedding before using ANN to find similar items. Nonetheless, in the examples below, we\\u2019ll also see systems using graphs (DoorDash) and decision trees (LinkedIn).\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Ranking\"), \" is a slower\\u2014but more precise\\u2014step to score and rank top candidates. As we\\u2019re processing fewer items (i.e., hundreds instead of millions), we have room to add features that would have been infeasible in the retrieval step (due to compute and latency constraints). Such features include item and user data, and contextual information. We can also use more sophisticated models with more layers and parameters. \"), mdx(\"p\", null, \"Ranking can be modeled as a learning-to-rank or classification task, with the latter being more commonly seen. If deep learning is applied, the final output layer is either a softmax over a catalog of items, or a sigmoid predicting the likelihood of user interaction (e.g., click, purchase) for each user-item pair.\"), mdx(\"p\", null, \"Next, let\\u2019s see how the processes above come together in a recommender or search system. \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.99999999999999%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe60Io//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAACAwEAAAAAAAAAAAAAAAAAEQEQUSH/2gAIAQEAAT8hl6d0hiFX/9oADAMBAAIAAwAAABCjz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAAMAAgMBAAAAAAAAAAAAAAABITFhEUFRof/aAAgBAQABPxCrcLjAl1Sr76Qt2NG6hJZowf/Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Basic system design for recommendations and search, based on the 2 x 2 above.\",\n    \"title\": \"Basic system design for recommendations and search, based on the 2 x 2 above.\",\n    \"src\": \"/static/d0d1c41488042a1ac7f528c2e16ddccb/29d31/discovery-system-design.jpg\",\n    \"srcSet\": [\"/static/d0d1c41488042a1ac7f528c2e16ddccb/e52aa/discovery-system-design.jpg 175w\", \"/static/d0d1c41488042a1ac7f528c2e16ddccb/70ebb/discovery-system-design.jpg 350w\", \"/static/d0d1c41488042a1ac7f528c2e16ddccb/29d31/discovery-system-design.jpg 700w\", \"/static/d0d1c41488042a1ac7f528c2e16ddccb/a2510/discovery-system-design.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"Basic system design for recommendations and search, based on the 2 x 2 above.\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"In the offline environment, data flows bottom-up,\"), \" where we use training data and item/user data to create artifacts such as models, ANN indices, and feature stores. These artifacts are then loaded into the online environment (via the dashed arrows). \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"In the online environment, each request flows left to right,\"), \" through the retrieval and ranking steps before returning a set of results (e.g., recommendations, search results).\"), mdx(\"p\", null, \"Additional details on some arrows in the diagram:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"With the representation learning model, embed items in the catalog.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"With the item embeddings, build the ANN index that allows retrieval of similar embeddings and their respective items.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Get (historical) features to augment training data for the ranking model. Use the same feature store in offline training and online serving to minimize train-serve skew. Might require \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"/resources/feature-stores/\"\n  }, \"time travel\"), \".\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Use the input query/item(s) embedding to retrieve similar items via ANN.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Add item and user features to the candidates for downstream ranking.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Rank the candidates based on objectives such as click, conversion, etc.  \")), mdx(\"h2\", {\n    \"id\": \"examples-from-alibaba-facebook-jd-doordash-etc\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Examples from Alibaba, Facebook, JD, Doordash, etc.\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#examples-from-alibaba-facebook-jd-doordash-etc\",\n    \"aria-label\": \"examples from alibaba facebook jd doordash etc permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"height\": \"20px\",\n    \"width\": \"20px\",\n    \"style\": {\n      \"verticalAlign\": \"-10%\",\n      \"marginLeft\": \"0.25rem\"\n    },\n    \"fill\": \"#007bff\",\n    \"x\": \"0px\",\n    \"y\": \"0px\",\n    \"viewBox\": \"0 0 100 100\",\n    \"enableBackground\": \"new 0 0 100 52\",\n    \"xmlSpace\": \"preserve\"\n  }, mdx(\"g\", {\n    parentName: \"svg\",\n    \"transform\": \"matrix(0.6136733,-0.6136733,0.6136733,0.6136733,4.0598725,65.6509)\"\n  }, mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 47.807,33.138 c 0.008,-0.009 0.016,-0.019 0.024,-0.026 -0.009,0.007 -0.018,0.015 -0.026,0.023 0,0.001 10e-4,0.002 0.002,0.003 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 53.048,49.8 c -0.274,-0.071 -0.545,-0.152 -0.815,-0.232 -0.002,0.001 -0.005,0.003 -0.007,0.003 0.259,0.077 0.534,0.155 0.822,0.229 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 36.33,35.501 h -0.004 c 0.204,0.522 0.496,1.114 0.783,1.651 h 0.013 c -0.284,-0.54 -0.548,-1.09 -0.792,-1.651 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 37.108,37.152 c 0.291,0.544 0.577,1.029 0.758,1.332 -0.263,-0.436 -0.508,-0.882 -0.746,-1.332 h -0.012 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 38.062,38.804 h 0.006 c -0.048,-0.079 -0.1,-0.152 -0.147,-0.231 0.087,0.144 0.141,0.231 0.141,0.231 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 51.812,49.445 c -0.631,-0.197 -1.249,-0.424 -1.856,-0.669 -0.003,0.002 -0.007,0.003 -0.009,0.004 0.06,0.025 0.781,0.324 1.865,0.665 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 52.226,49.57 c 0.002,0 0.005,-0.002 0.007,-0.003 -0.106,-0.03 -0.213,-0.057 -0.318,-0.091 0.101,0.033 0.205,0.065 0.311,0.094 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"M 74.458,0.955 H 59.321 c -1.307,0 -2.591,0.1 -3.845,0.293 -0.273,0.042 -0.541,0.101 -0.811,0.151 4.646,2.666 8.469,6.605 10.987,11.343 h 1.238 8.346 c 7.322,0 13.257,5.937 13.257,13.259 0,7.321 -5.936,13.258 -13.257,13.258 H 65.72 63.762 61.857 61.851 58.68 c -3.305,0 -6.324,-1.212 -8.646,-3.212 0,0 -0.003,0.003 -0.003,0.003 0,-0.002 -10e-4,-0.002 -0.002,-0.003 -0.494,-0.414 -0.886,-0.802 -1.206,-1.148 -0.7,-0.764 -1.011,-1.303 -1.011,-1.303 0.001,-0.002 0.002,-0.002 0.002,-0.003 -10e-4,-0.001 -0.002,-0.002 -0.002,-0.003 -1.505,-2.15 -2.389,-4.766 -2.389,-7.589 0,-2.746 0.834,-5.296 2.263,-7.413 0.041,-0.06 0.086,-0.117 0.127,-0.176 -1.736,-1.473 -3.978,-2.367 -6.429,-2.367 h -5.041 c -1.325,3.052 -2.067,6.416 -2.067,9.956 0,3.538 0.737,6.903 2.061,9.955 0.244,0.561 0.509,1.111 0.792,1.651 0.237,0.45 0.482,0.896 0.746,1.332 0.02,0.033 0.036,0.059 0.054,0.088 0.047,0.079 0.099,0.152 0.147,0.231 2.792,4.463 6.948,7.98 11.888,9.973 0.608,0.245 1.226,0.472 1.856,0.669 0.034,0.011 0.068,0.022 0.103,0.031 0.105,0.034 0.212,0.061 0.318,0.091 0.27,0.08 0.541,0.161 0.815,0.232 0.004,0 0.006,0.002 0.01,0.003 2,0.513 4.096,0.787 6.254,0.787 H 74.457 C 88.289,51.044 99.501,39.831 99.501,26 99.502,12.169 88.29,0.955 74.458,0.955 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 25.542,51.045 h 15.137 c 1.308,0 2.592,-0.101 3.846,-0.294 0.273,-0.042 0.542,-0.1 0.811,-0.151 C 40.69,47.935 36.866,43.996 34.349,39.258 H 33.11 24.764 c -7.322,0 -13.257,-5.936 -13.257,-13.259 0,-7.322 5.935,-13.257 13.257,-13.257 h 9.516 1.957 1.905 0.007 3.17 c 3.304,0 6.323,1.212 8.645,3.212 l 0.002,-0.003 c 10e-4,10e-4 10e-4,0.002 0.002,0.003 0.495,0.413 0.887,0.801 1.206,1.148 0.701,0.762 1.011,1.302 1.011,1.302 0,0.001 -0.001,0.002 -0.002,0.003 10e-4,0 0.002,0.001 0.003,0.003 1.505,2.15 2.39,4.766 2.39,7.588 0,2.746 -0.835,5.297 -2.264,7.412 -0.041,0.062 -0.085,0.118 -0.127,0.176 1.736,1.474 3.979,2.369 6.429,2.369 h 5.042 c 1.324,-3.053 2.065,-6.417 2.065,-9.957 0,-3.539 -0.737,-6.903 -2.061,-9.955 C 63.416,15.482 63.151,14.932 62.868,14.392 62.631,13.941 62.386,13.494 62.122,13.06 62.102,13.027 62.086,13 62.069,12.971 62.021,12.893 61.97,12.818 61.922,12.741 59.13,8.278 54.973,4.76 50.034,2.768 49.426,2.523 48.808,2.297 48.178,2.098 48.144,2.087 48.11,2.077 48.075,2.066 47.97,2.034 47.863,2.007 47.757,1.977 47.487,1.896 47.216,1.815 46.941,1.745 46.937,1.744 46.935,1.744 46.932,1.743 44.932,1.228 42.837,0.955 40.677,0.955 H 25.542 c -13.832,0 -25.044,11.212 -25.044,25.044 0,13.833 11.212,25.046 25.044,25.046 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"M 53.058,49.803 C 53.055,49.802 53.052,49.8 53.048,49.8 c 0.004,0 0.007,0.002 0.01,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 51.812,49.445 c 0.034,0.011 0.068,0.022 0.103,0.031 -0.034,-0.008 -0.068,-0.02 -0.103,-0.031 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 47.805,33.141 c 0,0 0.311,0.539 1.011,1.303 0.005,-0.006 0.01,-0.012 0.016,-0.015 -0.369,-0.407 -0.709,-0.84 -1.025,-1.291 0,0.001 -0.001,0.001 -0.002,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 37.92,38.572 c -0.018,-0.029 -0.034,-0.055 -0.054,-0.088 0.019,0.03 0.036,0.058 0.054,0.088 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 48.832,34.429 c -0.006,0.003 -0.011,0.009 -0.016,0.015 0.319,0.347 0.711,0.734 1.206,1.148 0.001,-0.002 0.002,-0.003 0.002,-0.003 -0.42,-0.362 -0.82,-0.749 -1.192,-1.16 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 50.027,35.592 c 10e-4,-0.003 0.004,-0.006 0.012,-0.015 -0.004,0.004 -0.01,0.008 -0.015,0.012 10e-4,0 0.002,0.001 0.003,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"rect\", {\n    parentName: \"g\",\n    \"height\": \"0.004007bff2\",\n    \"width\": \"0.004007bff2\",\n    \"y\": \"35.59\",\n    \"x\": \"50.021999\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }))))), mdx(\"p\", null, \"Next, we\\u2019ll briefly discuss the high-level system design of some discovery systems, based on their respective papers and tech blogs. I\\u2019ll highlight how these systems are split into offline and online environments, and their retrieval and ranking steps. For full details on the methodology, model, etc., I recommend you read the full paper/blog. \"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"We start with Alibaba\\u2019s sharing about \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://arxiv.org/abs/1803.02349\"\n  }, \"building item embeddings for candidate retrieval\"), \".\"), \" In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"offline\"), \" environment, session-level user-item interactions are mined to construct a weighted, bidirectional item graph. The graph is then used to generate item sequences via random walks. Item embeddings are then learned via representation learning (i.e., word2vec skip-gram), doing away with the need for labels. Finally, with the item embeddings, they get the nearest neighbor for each item and store it in their item-to-item (i2) similarity map (i.e., a key-value store). \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"54.85714285714286%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdt1IDD/xAAYEAADAQEAAAAAAAAAAAAAAAAAAQIQEf/aAAgBAQABBQIRK5Is/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRABAQEBAQEAAAAAAAAAAAAAAQARMSFB/9oACAEBAAE/Id6a2n7ZAuwew7Bf/9oADAMBAAIAAwAAABCTz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAESFRMUGRYf/aAAgBAQABPxDJAUei4lcitEZkWW29/YF+fYG/sIO/Z//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Alibaba's design for candidate retrieval in Taobao via item embeddings and ANN.\",\n    \"title\": \"Alibaba's design for candidate retrieval in Taobao via item embeddings and ANN.\",\n    \"src\": \"/static/13f041505218b48e518f94d8b8490932/29d31/alibaba-retrieval-design.jpg\",\n    \"srcSet\": [\"/static/13f041505218b48e518f94d8b8490932/e52aa/alibaba-retrieval-design.jpg 175w\", \"/static/13f041505218b48e518f94d8b8490932/70ebb/alibaba-retrieval-design.jpg 350w\", \"/static/13f041505218b48e518f94d8b8490932/29d31/alibaba-retrieval-design.jpg 700w\", \"/static/13f041505218b48e518f94d8b8490932/a2510/alibaba-retrieval-design.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"Alibaba's design for candidate retrieval in Taobao via item embeddings and ANN.\",\n    source: \"https://arxiv.org/abs/1803.02349\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, \"In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"online\"), \" environment, when the user launches the app, the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://taobao.com\"\n  }, \"Taobao\"), \" Personalization Platform (TPP) starts by fetching the latest items that the user interacted with (e.g., click, like, purchase). These items are then used to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"retrieve\"), \" candidates from the i2i similarity map. The candidates are then passed to the Ranking Service Platform (RSP) for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ranking\"), \" via a deep neural network, before being displayed to the user.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Alibaba also shared a similar example where they apply a \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://arxiv.org/abs/2005.12002\"\n  }, \"graph network for ranking\"), \".\"), \" In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"offline\"), \" environment, they combine an existing knowledge graph (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"G\"), \"), user behavior (e.g., impressed but not clicked, clicked), and item data to create an adaptive knowledge graph (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"G_ui\"), \"). This is then merged with user data (e.g., demographics, user-item preferences) to train the ranking model (Adaptive Target-Behavior Relational Graph Network, ATBRN).\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"87.99999999999999%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe2g0BYAH//EABgQAAMBAQAAAAAAAAAAAAAAAAABERAg/9oACAEBAAEFAuLBaj//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAWEAEBAQAAAAAAAAAAAAAAAAABECD/2gAIAQEABj8Cqa//xAAcEAEAAgIDAQAAAAAAAAAAAAABACERMRBBUWH/2gAIAQEAAT8hsaiomDvuHyO/SHhuACuRgqf/2gAMAwEAAgADAAAAEKMHPP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExQWFRocH/2gAIAQEAAT8QbGovbn5LgM1bOupWnYV5uZAEFoA9yiZlwyyg6Wyoh4IFAA6n/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Alibaba's design for ranking in Taobao via a graph network (ATBRN).\",\n    \"title\": \"Alibaba's design for ranking in Taobao via a graph network (ATBRN).\",\n    \"src\": \"/static/be6b134e087bcbe4885988a48054ee93/29d31/alibaba-ranking-design.jpg\",\n    \"srcSet\": [\"/static/be6b134e087bcbe4885988a48054ee93/e52aa/alibaba-ranking-design.jpg 175w\", \"/static/be6b134e087bcbe4885988a48054ee93/70ebb/alibaba-ranking-design.jpg 350w\", \"/static/be6b134e087bcbe4885988a48054ee93/29d31/alibaba-ranking-design.jpg 700w\", \"/static/be6b134e087bcbe4885988a48054ee93/a2510/alibaba-ranking-design.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"Alibaba's design for ranking in Taobao via a graph network (ATBRN).\",\n    source: \"https://arxiv.org/abs/2005.12002\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, \"In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"online\"), \" environment, given a user request, the candidate generator \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"retrieves\"), \" a set of candidates and the user ID, before passing them to the Real-Time Prediction (RTP) platform. RTP then queries the knowledge graph and feature stores for item and user attributes. The graph representations, item data, and user data is then fed into the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ranking\"), \" model (i.e., ATBRN) to predict the probability of click on each candidate item. The candidates are then reordered based on probability and displayed to the user. \"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Next, we look at Facebook\\u2019s \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://arxiv.org/abs/2006.11632\"\n  }, \"embedding-based retrieval for search\"), \".\"), \" In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"offline\"), \" environment (right half of image), they first train a two-tower network\\u2014with a query encoder and document encoder\\u2014that outputs cosine similarity for each query-document pair (not shown in image). This ensures that search queries and documents (e.g., user profiles, groups) are in the same embedding space. \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"79.42857142857143%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB2pRksAX/xAAYEAEAAwEAAAAAAAAAAAAAAAABABEiMf/aAAgBAQABBQJi0ETQZOf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAADAQEAAAAAAAAAAAAAAAABEDEAEf/aAAgBAQAGPwJy7hC//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARIUGBwf/aAAgBAQABPyHblPyIiI+RKaVKFx1HtQmgs//aAAwDAQACAAMAAAAQ7w//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCH/8QAGhABAQEBAQEBAAAAAAAAAAAAEQEAITFBgf/aAAgBAQABPxB9we+fr3d6rwxAjL7BWVVrjAlSVddgC35v/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Facebook's design for embedding-based retrieval via query and document encoders.\",\n    \"title\": \"Facebook's design for embedding-based retrieval via query and document encoders.\",\n    \"src\": \"/static/139ce8a45c2f7bfd1b2f60d1b8c5efc8/29d31/facebook-retrieval-design.jpg\",\n    \"srcSet\": [\"/static/139ce8a45c2f7bfd1b2f60d1b8c5efc8/e52aa/facebook-retrieval-design.jpg 175w\", \"/static/139ce8a45c2f7bfd1b2f60d1b8c5efc8/70ebb/facebook-retrieval-design.jpg 350w\", \"/static/139ce8a45c2f7bfd1b2f60d1b8c5efc8/29d31/facebook-retrieval-design.jpg 700w\", \"/static/139ce8a45c2f7bfd1b2f60d1b8c5efc8/a2510/facebook-retrieval-design.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"Facebook's design for embedding-based retrieval via query and document encoders.\",\n    source: \"https://arxiv.org/abs/2006.11632\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, \"Then, with the document encoder, they embed each document via Spark batch jobs. The embeddings are quantized and published into the ANN index (\\u201Cinverted index\\u201D). This ANN index is based on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://engineering.fb.com/2017/03/29/data-infrastructure/faiss-a-library-for-efficient-similarity-search/\"\n  }, \"Faiss\"), \" and fine-tuned (see Section 4.1 of paper). The embeddings are also published in a forward index, without quantization, for ranking. The forward index includes other data such as profile and group attributes to augment candidates during ranking. \"), mdx(\"p\", null, \"In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"online\"), \" environment, each search request goes through query understanding and is embedded via the query encoder. The search request and associated embedding then go through the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"retrieval\"), \" step to get nearest neighbor candidates via the ANN index and boolean filtering (e.g., match on name, location, etc.). The candidates are then augmented with full embeddings and additional data from the forward index before being \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ranked\"), \".\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"JD shared a similar approach for \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://arxiv.org/abs/2006.02282\"\n  }, \"semantic retrieval for search\"), \".\"), \" In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"offline\"), \" environment, a two-tower model with a query encoder and an item encoder is trained to output a similarity score for each query-item pair. The item encoder then embeds catalog items before loading them into an embedding index (i.e., key-value store).\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"38.857142857142854%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3QUD/8QAFhAAAwAAAAAAAAAAAAAAAAAAAAEQ/9oACAEBAAEFAhT/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAWEAADAAAAAAAAAAAAAAAAAAAAARD/2gAIAQEAAT8hhH//2gAMAwEAAgADAAAAEIAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAAMBAQAAAAAAAAAAAAAAAQARITFR/9oACAEBAAE/EB6G77L6K1OJ/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Major stages of an e-commerce search systems (left), JD's design for candidate retrieval (right).\",\n    \"title\": \"Major stages of an e-commerce search systems (left), JD's design for candidate retrieval (right).\",\n    \"src\": \"/static/cf92f90974027a10f0f46a62f303ec5d/29d31/jd-retrieval-design.jpg\",\n    \"srcSet\": [\"/static/cf92f90974027a10f0f46a62f303ec5d/e52aa/jd-retrieval-design.jpg 175w\", \"/static/cf92f90974027a10f0f46a62f303ec5d/70ebb/jd-retrieval-design.jpg 350w\", \"/static/cf92f90974027a10f0f46a62f303ec5d/29d31/jd-retrieval-design.jpg 700w\", \"/static/cf92f90974027a10f0f46a62f303ec5d/a2510/jd-retrieval-design.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"Major stages of an e-commerce search systems (left), JD's design for candidate retrieval (right).\",\n    source: \"https://arxiv.org/abs/2006.02282\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, \"Then, in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"online\"), \" environment, each query goes through preprocessing (e.g., spelling correction, tokenization, expansion, and rewriting) before being embedding via the query encoder. The query embedding is then used to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"retrieve\"), \" candidates from the embedding index via nearest neighbors lookup. The candidates are then \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ranked\"), \" on factors such as relevance, predicted conversion, etc.\"), mdx(\"p\", null, \"The paper also shares practical tips to optimize model training and serving. For model training, they raised that the de facto input of user-item interaction, item data, and user data is duplicative\\u2014item and user data appear once per row, consuming significant disk space. To address this, they built a custom TensorFlow dataset where user and item data are first loaded into memory as lookup dictionaries. Then, during training, these dictionaries are queried to append user and item attributes to the training set. This simple practice reduced training data size by 90%.\"), mdx(\"p\", null, \"They also called out the importance of ensuring offline training and online serving consistency. For their system, the most critical step was text tokenization which happens thrice (data preprocessing, training, serving). To minimize train-serve skew, they built a C++ tokenizer with a thin Python wrapper that was used for all tokenization tasks. \"), mdx(\"p\", null, \"For model serving, they reduced latency by combining services. Their model had two key steps: query embedding and ANN lookup. The simple approach would be to have each as a separate service, but this would require two network calls and thus double network latency. Thus, they unified the query embedding model and ANN lookup in a single instance, where the query embedding is passed to the ANN via memory instead of network. \"), mdx(\"p\", null, \"They also shared how they run hundreds of models simultaneously, for different retrieval tasks and various A/B tests. Each \\\"servable\\\" consists of a query embedding model and an ANN lookup, requiring 10s of GB. Thus, each servable had their own instance, with a proxy module (or load balancer) to direct incoming requests to the right servable.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.42857142857143%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3VAH/8QAFxAAAwEAAAAAAAAAAAAAAAAAABEgMf/aAAgBAQABBQJmT//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABgQAQEBAQEAAAAAAAAAAAAAABEBABAh/9oACAEBAAE/IUhxLT2GJjBv/9oADAMBAAIAAwAAABBzz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8Q1UFOb2LY6i6vkZYF8u4t07ENWcgBQZP/2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"How JD organizes the embedding model and ANN indices across multiple versions.\",\n    \"title\": \"How JD organizes the embedding model and ANN indices across multiple versions.\",\n    \"src\": \"/static/a03910f240c552e78a600306e0d31f56/29d31/jd-model-server.jpg\",\n    \"srcSet\": [\"/static/a03910f240c552e78a600306e0d31f56/e52aa/jd-model-server.jpg 175w\", \"/static/a03910f240c552e78a600306e0d31f56/70ebb/jd-model-server.jpg 350w\", \"/static/a03910f240c552e78a600306e0d31f56/29d31/jd-model-server.jpg 700w\", \"/static/a03910f240c552e78a600306e0d31f56/a2510/jd-model-server.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"How JD organizes the embedding model and ANN indices across multiple versions.\",\n    source: \"https://arxiv.org/abs/2006.02282\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, \"(Aside: My candidate retrieval systems have a similar design pattern. Embedding stores and ANN indices are hosted on the same docker container\\u2014you\\u2019ll be surprised how far this goes with efficiently-sized embeddings. Furthermore, Docker makes it easy to version, deploy, and roll back each model, as well as scale horizontally. Fronting the model instances with a load balancer takes care of directing incoming requests, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.aws.amazon.com/wellarchitected/latest/machine-learning-lens/bluegreen-deployments.html\"\n  }, \"blue-green deployments\"), \", and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.aws.amazon.com/sagemaker/latest/dg/model-ab-testing.html\"\n  }, \"A/B testing\"), \". SageMaker makes this easy.)\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Next, we move from the embedding + ANN paradigm and look at DoorDash\\u2019s use of a \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://doordash.engineering/2020/12/15/understanding-search-intent-with-better-recall/\"\n  }, \"knowledge graph for query expansion and retrieval\"), \".\"), \" In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"offline\"), \" environment, they train models for query understanding, query expansion, and ranking. They also load documents (i.e., restaurants and food items) into ElasticSearch for use in retrieval, and attribute data (e.g., ratings, price points, tags) into a feature store. \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"80%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB6kNUnFRP/8QAGRAAAwEBAQAAAAAAAAAAAAAAAAERAgMy/9oACAEBAAEFAoc/VKjKhl1f/8QAFREBAQAAAAAAAAAAAAAAAAAAECH/2gAIAQMBAT8Bp//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAQACAwAAAAAAAAAAAAAAAAEAEAIRIf/aAAgBAQAGPwLqxty3X//EABwQAAICAwEBAAAAAAAAAAAAAAABETEhQVFhkf/aAAgBAQABPyFNWziZQq7RQp6fw9hKIxa5QiyfYP/aAAwDAQACAAMAAAAQB8//xAAYEQEAAwEAAAAAAAAAAAAAAAABABExIf/aAAgBAwEBPxANDyUOE//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEWH/2gAIAQIBAT8QUt7f/8QAHRABAQACAgMBAAAAAAAAAAAAAREAIUFhMVFxwf/aAAgBAQABPxASL12UHbMIxsWV7ww00Ylef3LHa8OAhUI3y9YIS5poV+Z//9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"DoorDash splits search into offline and online, and retrieval (recall) and ranking (precision).\",\n    \"title\": \"DoorDash splits search into offline and online, and retrieval (recall) and ranking (precision).\",\n    \"src\": \"/static/d07b3c6828d22a4edab5f022e626e8b6/29d31/doordash-search-design.jpg\",\n    \"srcSet\": [\"/static/d07b3c6828d22a4edab5f022e626e8b6/e52aa/doordash-search-design.jpg 175w\", \"/static/d07b3c6828d22a4edab5f022e626e8b6/70ebb/doordash-search-design.jpg 350w\", \"/static/d07b3c6828d22a4edab5f022e626e8b6/29d31/doordash-search-design.jpg 700w\", \"/static/d07b3c6828d22a4edab5f022e626e8b6/a2510/doordash-search-design.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"DoorDash splits search into offline and online, and retrieval (recall) and ranking (precision).\",\n    source: \"https://doordash.engineering/2020/12/15/understanding-search-intent-with-better-recall/\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, \"In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"online\"), \" environment, each incoming query is first standardized (e.g., spell check) and synonymized (via a manually curated dictionary). Then, the knowledge graph (Neo4J) \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/resources/feature-stores/\"\n  }, \"expands the query\"), \" by finding related tags. For example, a query for \\u201CKFC\\u201D will return tags such as \\u201Cfried chicken\\u201D and \\u201Cwings\\u201D. These tags are then used to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"retrieve\"), \" similar restaurants such as \\u201CPopeyes\\u201D and \\u201CBonchon\\u201D. \"), mdx(\"p\", null, \"These candidates are then \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ranked\"), \" based on lexical similarity between the query and documents (aka restaurants, food items), store popularity, and possibly the search context (e.g., time of day, location). Finally, the ranked results are augmented with attributes such as ratings, price point, and delivery time and cost before displayed to the customer. \"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Finally, we look at how LinkedIn \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://arxiv.org/abs/1902.09041\"\n  }, \"personalizes talent search results\"), \".\"), \" Their system relies heavily on XGBoost, first as a model to retrieve the top 1,000 candidates for ranking, and second, as a generator of features (i.e., model scores, tree interactions) for their downstream ranking model (a generalized linear mixed model aka GLMix).\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"53.14285714285714%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe6SW0f/xAAWEAADAAAAAAAAAAAAAAAAAAABECD/2gAIAQEAAQUCgr//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAYEAEBAQEBAAAAAAAAAAAAAAABABEQMf/aAAgBAQABPyE2TILDk8v/2gAMAwEAAgADAAAAEMDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgMBAQAAAAAAAAAAAAAAASEAETFBYf/aAAgBAQABPxAkpPsEzIzYUXZ6pcAaYuAgPZhP/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"LinkedIn's offline design for generating tree-based features, and training GLMix ranking models.\",\n    \"title\": \"LinkedIn's offline design for generating tree-based features, and training GLMix ranking models.\",\n    \"src\": \"/static/90b2924b4e109b91c579b08f3433560e/29d31/linkedin-offline-design.jpg\",\n    \"srcSet\": [\"/static/90b2924b4e109b91c579b08f3433560e/e52aa/linkedin-offline-design.jpg 175w\", \"/static/90b2924b4e109b91c579b08f3433560e/70ebb/linkedin-offline-design.jpg 350w\", \"/static/90b2924b4e109b91c579b08f3433560e/29d31/linkedin-offline-design.jpg 700w\", \"/static/90b2924b4e109b91c579b08f3433560e/a2510/linkedin-offline-design.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"LinkedIn's offline design for generating tree-based features, and training GLMix ranking models.\",\n    source: \"https://arxiv.org/abs/1902.09041\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, \"In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"offline\"), \" environment,  they first combine impression and label data to generate training data (step 1 in image above). Labels consist of instances where the recruiter sent a message to potential hires and the user responded positively. The training data is then fed into a pre-trained XGBoost model to generate model scores and tree interaction features (step 3 in image above) to augment the training data. This augmented data is then used to train the ranking model (GLMix). \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"700px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"57.714285714285715%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe4qQ0f/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAbEAACAQUAAAAAAAAAAAAAAAAAATEQESFxkf/aAAgBAQABPyGE82H0Wximn//aAAwDAQACAAMAAAAQI8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEBAQACAwAAAAAAAAAAAAABEQAhYTFBUf/aAAgBAQABPxABh2O86sfA51S8r1jWWcZKy+st3//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"LinkedIn's online design for candidate retrieval, feature augmentation, and ranking via GLMix.\",\n    \"title\": \"LinkedIn's online design for candidate retrieval, feature augmentation, and ranking via GLMix.\",\n    \"src\": \"/static/8611e810bbcdb9b867a8946b14c4ca4e/29d31/linkedin-online-design.jpg\",\n    \"srcSet\": [\"/static/8611e810bbcdb9b867a8946b14c4ca4e/e52aa/linkedin-online-design.jpg 175w\", \"/static/8611e810bbcdb9b867a8946b14c4ca4e/70ebb/linkedin-online-design.jpg 350w\", \"/static/8611e810bbcdb9b867a8946b14c4ca4e/29d31/linkedin-online-design.jpg 700w\", \"/static/8611e810bbcdb9b867a8946b14c4ca4e/a2510/linkedin-online-design.jpg 1000w\"],\n    \"sizes\": \"(max-width: 700px) 100vw, 700px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(FigureCaption, {\n    caption: \"LinkedIn's online design for candidate retrieval, feature augmentation, and ranking via GLMix.\",\n    source: \"https://arxiv.org/abs/1902.09041\",\n    mdxType: \"FigureCaption\"\n  }), mdx(\"p\", null, \"In the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"online\"), \" environment, with each search request, the search engine (maybe Elastic or Solr?) first \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"retrieves\"), \" candidates which are then scored via a first-level XGBoost model. The top 1,000 candidates are then augmented with (i) additional features (step 2 in image above) and (ii) tree interaction features via a second-level XGBoost model (step 3 in image above). Finally, these augmented candidates are ranked before the top 125 results are shown to the user.\"), mdx(\"h2\", {\n    \"id\": \"conclusion\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Conclusion\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#conclusion\",\n    \"aria-label\": \"conclusion permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"height\": \"20px\",\n    \"width\": \"20px\",\n    \"style\": {\n      \"verticalAlign\": \"-10%\",\n      \"marginLeft\": \"0.25rem\"\n    },\n    \"fill\": \"#007bff\",\n    \"x\": \"0px\",\n    \"y\": \"0px\",\n    \"viewBox\": \"0 0 100 100\",\n    \"enableBackground\": \"new 0 0 100 52\",\n    \"xmlSpace\": \"preserve\"\n  }, mdx(\"g\", {\n    parentName: \"svg\",\n    \"transform\": \"matrix(0.6136733,-0.6136733,0.6136733,0.6136733,4.0598725,65.6509)\"\n  }, mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 47.807,33.138 c 0.008,-0.009 0.016,-0.019 0.024,-0.026 -0.009,0.007 -0.018,0.015 -0.026,0.023 0,0.001 10e-4,0.002 0.002,0.003 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 53.048,49.8 c -0.274,-0.071 -0.545,-0.152 -0.815,-0.232 -0.002,0.001 -0.005,0.003 -0.007,0.003 0.259,0.077 0.534,0.155 0.822,0.229 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 36.33,35.501 h -0.004 c 0.204,0.522 0.496,1.114 0.783,1.651 h 0.013 c -0.284,-0.54 -0.548,-1.09 -0.792,-1.651 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 37.108,37.152 c 0.291,0.544 0.577,1.029 0.758,1.332 -0.263,-0.436 -0.508,-0.882 -0.746,-1.332 h -0.012 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 38.062,38.804 h 0.006 c -0.048,-0.079 -0.1,-0.152 -0.147,-0.231 0.087,0.144 0.141,0.231 0.141,0.231 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 51.812,49.445 c -0.631,-0.197 -1.249,-0.424 -1.856,-0.669 -0.003,0.002 -0.007,0.003 -0.009,0.004 0.06,0.025 0.781,0.324 1.865,0.665 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 52.226,49.57 c 0.002,0 0.005,-0.002 0.007,-0.003 -0.106,-0.03 -0.213,-0.057 -0.318,-0.091 0.101,0.033 0.205,0.065 0.311,0.094 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"M 74.458,0.955 H 59.321 c -1.307,0 -2.591,0.1 -3.845,0.293 -0.273,0.042 -0.541,0.101 -0.811,0.151 4.646,2.666 8.469,6.605 10.987,11.343 h 1.238 8.346 c 7.322,0 13.257,5.937 13.257,13.259 0,7.321 -5.936,13.258 -13.257,13.258 H 65.72 63.762 61.857 61.851 58.68 c -3.305,0 -6.324,-1.212 -8.646,-3.212 0,0 -0.003,0.003 -0.003,0.003 0,-0.002 -10e-4,-0.002 -0.002,-0.003 -0.494,-0.414 -0.886,-0.802 -1.206,-1.148 -0.7,-0.764 -1.011,-1.303 -1.011,-1.303 0.001,-0.002 0.002,-0.002 0.002,-0.003 -10e-4,-0.001 -0.002,-0.002 -0.002,-0.003 -1.505,-2.15 -2.389,-4.766 -2.389,-7.589 0,-2.746 0.834,-5.296 2.263,-7.413 0.041,-0.06 0.086,-0.117 0.127,-0.176 -1.736,-1.473 -3.978,-2.367 -6.429,-2.367 h -5.041 c -1.325,3.052 -2.067,6.416 -2.067,9.956 0,3.538 0.737,6.903 2.061,9.955 0.244,0.561 0.509,1.111 0.792,1.651 0.237,0.45 0.482,0.896 0.746,1.332 0.02,0.033 0.036,0.059 0.054,0.088 0.047,0.079 0.099,0.152 0.147,0.231 2.792,4.463 6.948,7.98 11.888,9.973 0.608,0.245 1.226,0.472 1.856,0.669 0.034,0.011 0.068,0.022 0.103,0.031 0.105,0.034 0.212,0.061 0.318,0.091 0.27,0.08 0.541,0.161 0.815,0.232 0.004,0 0.006,0.002 0.01,0.003 2,0.513 4.096,0.787 6.254,0.787 H 74.457 C 88.289,51.044 99.501,39.831 99.501,26 99.502,12.169 88.29,0.955 74.458,0.955 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 25.542,51.045 h 15.137 c 1.308,0 2.592,-0.101 3.846,-0.294 0.273,-0.042 0.542,-0.1 0.811,-0.151 C 40.69,47.935 36.866,43.996 34.349,39.258 H 33.11 24.764 c -7.322,0 -13.257,-5.936 -13.257,-13.259 0,-7.322 5.935,-13.257 13.257,-13.257 h 9.516 1.957 1.905 0.007 3.17 c 3.304,0 6.323,1.212 8.645,3.212 l 0.002,-0.003 c 10e-4,10e-4 10e-4,0.002 0.002,0.003 0.495,0.413 0.887,0.801 1.206,1.148 0.701,0.762 1.011,1.302 1.011,1.302 0,0.001 -0.001,0.002 -0.002,0.003 10e-4,0 0.002,0.001 0.003,0.003 1.505,2.15 2.39,4.766 2.39,7.588 0,2.746 -0.835,5.297 -2.264,7.412 -0.041,0.062 -0.085,0.118 -0.127,0.176 1.736,1.474 3.979,2.369 6.429,2.369 h 5.042 c 1.324,-3.053 2.065,-6.417 2.065,-9.957 0,-3.539 -0.737,-6.903 -2.061,-9.955 C 63.416,15.482 63.151,14.932 62.868,14.392 62.631,13.941 62.386,13.494 62.122,13.06 62.102,13.027 62.086,13 62.069,12.971 62.021,12.893 61.97,12.818 61.922,12.741 59.13,8.278 54.973,4.76 50.034,2.768 49.426,2.523 48.808,2.297 48.178,2.098 48.144,2.087 48.11,2.077 48.075,2.066 47.97,2.034 47.863,2.007 47.757,1.977 47.487,1.896 47.216,1.815 46.941,1.745 46.937,1.744 46.935,1.744 46.932,1.743 44.932,1.228 42.837,0.955 40.677,0.955 H 25.542 c -13.832,0 -25.044,11.212 -25.044,25.044 0,13.833 11.212,25.046 25.044,25.046 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"M 53.058,49.803 C 53.055,49.802 53.052,49.8 53.048,49.8 c 0.004,0 0.007,0.002 0.01,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 51.812,49.445 c 0.034,0.011 0.068,0.022 0.103,0.031 -0.034,-0.008 -0.068,-0.02 -0.103,-0.031 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 47.805,33.141 c 0,0 0.311,0.539 1.011,1.303 0.005,-0.006 0.01,-0.012 0.016,-0.015 -0.369,-0.407 -0.709,-0.84 -1.025,-1.291 0,0.001 -0.001,0.001 -0.002,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 37.92,38.572 c -0.018,-0.029 -0.034,-0.055 -0.054,-0.088 0.019,0.03 0.036,0.058 0.054,0.088 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 48.832,34.429 c -0.006,0.003 -0.011,0.009 -0.016,0.015 0.319,0.347 0.711,0.734 1.206,1.148 0.001,-0.002 0.002,-0.003 0.002,-0.003 -0.42,-0.362 -0.82,-0.749 -1.192,-1.16 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 50.027,35.592 c 10e-4,-0.003 0.004,-0.006 0.012,-0.015 -0.004,0.004 -0.01,0.008 -0.015,0.012 10e-4,0 0.002,0.001 0.003,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"rect\", {\n    parentName: \"g\",\n    \"height\": \"0.004007bff2\",\n    \"width\": \"0.004007bff2\",\n    \"y\": \"35.59\",\n    \"x\": \"50.021999\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }))))), mdx(\"p\", null, \"That was a brief overview of the offline-online, retrieval-ranking pattern for search and recommendations. While this isn\\u2019t the only approach for discovery systems, from what I\\u2019ve seen, it\\u2019s the most common design pattern. I've found it helpful to distinguish the latency-constrained online systems from the less-demanding offline systems, and split the online process into retrieval and ranking steps. \"), mdx(\"p\", null, \"If you\\u2019re starting to build your discovery system, start with \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/resources/real-time-recommendations/\"\n  }, \"candidate retrieval via simple embeddings and approximate nearest neighbors\"), \", before adding a ranker on top of it. Alternatively, consider using a knowledge graph \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/resources/feature-stores/\"\n  }, \"like Uber and DoorDash did\"), \". But before you get too excited, think hard about whether you need real-time retrieval and ranking, or \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/resources/real-time-recommendations/\"\n  }, \"if batch recommendations will suffice\"), \".\"), mdx(\"h2\", {\n    \"id\": \"references\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"References\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#references\",\n    \"aria-label\": \"references permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"height\": \"20px\",\n    \"width\": \"20px\",\n    \"style\": {\n      \"verticalAlign\": \"-10%\",\n      \"marginLeft\": \"0.25rem\"\n    },\n    \"fill\": \"#007bff\",\n    \"x\": \"0px\",\n    \"y\": \"0px\",\n    \"viewBox\": \"0 0 100 100\",\n    \"enableBackground\": \"new 0 0 100 52\",\n    \"xmlSpace\": \"preserve\"\n  }, mdx(\"g\", {\n    parentName: \"svg\",\n    \"transform\": \"matrix(0.6136733,-0.6136733,0.6136733,0.6136733,4.0598725,65.6509)\"\n  }, mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 47.807,33.138 c 0.008,-0.009 0.016,-0.019 0.024,-0.026 -0.009,0.007 -0.018,0.015 -0.026,0.023 0,0.001 10e-4,0.002 0.002,0.003 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 53.048,49.8 c -0.274,-0.071 -0.545,-0.152 -0.815,-0.232 -0.002,0.001 -0.005,0.003 -0.007,0.003 0.259,0.077 0.534,0.155 0.822,0.229 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 36.33,35.501 h -0.004 c 0.204,0.522 0.496,1.114 0.783,1.651 h 0.013 c -0.284,-0.54 -0.548,-1.09 -0.792,-1.651 z\",\n    \"style\": {},\n    \"fill\": \"none\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 37.108,37.152 c 0.291,0.544 0.577,1.029 0.758,1.332 -0.263,-0.436 -0.508,-0.882 -0.746,-1.332 h -0.012 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 38.062,38.804 h 0.006 c -0.048,-0.079 -0.1,-0.152 -0.147,-0.231 0.087,0.144 0.141,0.231 0.141,0.231 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 51.812,49.445 c -0.631,-0.197 -1.249,-0.424 -1.856,-0.669 -0.003,0.002 -0.007,0.003 -0.009,0.004 0.06,0.025 0.781,0.324 1.865,0.665 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 52.226,49.57 c 0.002,0 0.005,-0.002 0.007,-0.003 -0.106,-0.03 -0.213,-0.057 -0.318,-0.091 0.101,0.033 0.205,0.065 0.311,0.094 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"M 74.458,0.955 H 59.321 c -1.307,0 -2.591,0.1 -3.845,0.293 -0.273,0.042 -0.541,0.101 -0.811,0.151 4.646,2.666 8.469,6.605 10.987,11.343 h 1.238 8.346 c 7.322,0 13.257,5.937 13.257,13.259 0,7.321 -5.936,13.258 -13.257,13.258 H 65.72 63.762 61.857 61.851 58.68 c -3.305,0 -6.324,-1.212 -8.646,-3.212 0,0 -0.003,0.003 -0.003,0.003 0,-0.002 -10e-4,-0.002 -0.002,-0.003 -0.494,-0.414 -0.886,-0.802 -1.206,-1.148 -0.7,-0.764 -1.011,-1.303 -1.011,-1.303 0.001,-0.002 0.002,-0.002 0.002,-0.003 -10e-4,-0.001 -0.002,-0.002 -0.002,-0.003 -1.505,-2.15 -2.389,-4.766 -2.389,-7.589 0,-2.746 0.834,-5.296 2.263,-7.413 0.041,-0.06 0.086,-0.117 0.127,-0.176 -1.736,-1.473 -3.978,-2.367 -6.429,-2.367 h -5.041 c -1.325,3.052 -2.067,6.416 -2.067,9.956 0,3.538 0.737,6.903 2.061,9.955 0.244,0.561 0.509,1.111 0.792,1.651 0.237,0.45 0.482,0.896 0.746,1.332 0.02,0.033 0.036,0.059 0.054,0.088 0.047,0.079 0.099,0.152 0.147,0.231 2.792,4.463 6.948,7.98 11.888,9.973 0.608,0.245 1.226,0.472 1.856,0.669 0.034,0.011 0.068,0.022 0.103,0.031 0.105,0.034 0.212,0.061 0.318,0.091 0.27,0.08 0.541,0.161 0.815,0.232 0.004,0 0.006,0.002 0.01,0.003 2,0.513 4.096,0.787 6.254,0.787 H 74.457 C 88.289,51.044 99.501,39.831 99.501,26 99.502,12.169 88.29,0.955 74.458,0.955 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 25.542,51.045 h 15.137 c 1.308,0 2.592,-0.101 3.846,-0.294 0.273,-0.042 0.542,-0.1 0.811,-0.151 C 40.69,47.935 36.866,43.996 34.349,39.258 H 33.11 24.764 c -7.322,0 -13.257,-5.936 -13.257,-13.259 0,-7.322 5.935,-13.257 13.257,-13.257 h 9.516 1.957 1.905 0.007 3.17 c 3.304,0 6.323,1.212 8.645,3.212 l 0.002,-0.003 c 10e-4,10e-4 10e-4,0.002 0.002,0.003 0.495,0.413 0.887,0.801 1.206,1.148 0.701,0.762 1.011,1.302 1.011,1.302 0,0.001 -0.001,0.002 -0.002,0.003 10e-4,0 0.002,0.001 0.003,0.003 1.505,2.15 2.39,4.766 2.39,7.588 0,2.746 -0.835,5.297 -2.264,7.412 -0.041,0.062 -0.085,0.118 -0.127,0.176 1.736,1.474 3.979,2.369 6.429,2.369 h 5.042 c 1.324,-3.053 2.065,-6.417 2.065,-9.957 0,-3.539 -0.737,-6.903 -2.061,-9.955 C 63.416,15.482 63.151,14.932 62.868,14.392 62.631,13.941 62.386,13.494 62.122,13.06 62.102,13.027 62.086,13 62.069,12.971 62.021,12.893 61.97,12.818 61.922,12.741 59.13,8.278 54.973,4.76 50.034,2.768 49.426,2.523 48.808,2.297 48.178,2.098 48.144,2.087 48.11,2.077 48.075,2.066 47.97,2.034 47.863,2.007 47.757,1.977 47.487,1.896 47.216,1.815 46.941,1.745 46.937,1.744 46.935,1.744 46.932,1.743 44.932,1.228 42.837,0.955 40.677,0.955 H 25.542 c -13.832,0 -25.044,11.212 -25.044,25.044 0,13.833 11.212,25.046 25.044,25.046 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"M 53.058,49.803 C 53.055,49.802 53.052,49.8 53.048,49.8 c 0.004,0 0.007,0.002 0.01,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 51.812,49.445 c 0.034,0.011 0.068,0.022 0.103,0.031 -0.034,-0.008 -0.068,-0.02 -0.103,-0.031 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 47.805,33.141 c 0,0 0.311,0.539 1.011,1.303 0.005,-0.006 0.01,-0.012 0.016,-0.015 -0.369,-0.407 -0.709,-0.84 -1.025,-1.291 0,0.001 -0.001,0.001 -0.002,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 37.92,38.572 c -0.018,-0.029 -0.034,-0.055 -0.054,-0.088 0.019,0.03 0.036,0.058 0.054,0.088 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 48.832,34.429 c -0.006,0.003 -0.011,0.009 -0.016,0.015 0.319,0.347 0.711,0.734 1.206,1.148 0.001,-0.002 0.002,-0.003 0.002,-0.003 -0.42,-0.362 -0.82,-0.749 -1.192,-1.16 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"path\", {\n    parentName: \"g\",\n    \"d\": \"m 50.027,35.592 c 10e-4,-0.003 0.004,-0.006 0.012,-0.015 -0.004,0.004 -0.01,0.008 -0.015,0.012 10e-4,0 0.002,0.001 0.003,0.003 z\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }), mdx(\"rect\", {\n    parentName: \"g\",\n    \"height\": \"0.004007bff2\",\n    \"width\": \"0.004007bff2\",\n    \"y\": \"35.59\",\n    \"x\": \"50.021999\",\n    \"style\": {},\n    \"fill\": \"#007bff\"\n  }))))), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://arxiv.org/abs/1803.02349\"\n  }, \"Billion-scale Embedding for E-commerce Recommendation\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Alibaba\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://arxiv.org/abs/2005.12002\"\n  }, \"Adaptive Target-Behavior Relational Graph Network\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Alibaba\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://arxiv.org/abs/2006.11632\"\n  }, \"Embedding-based Retrieval in Facebook Search\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Facebook\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://arxiv.org/abs/2006.02282\"\n  }, \"End-to-End Solution for E-commerce Search via Embedding Learning\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"JD\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://doordash.engineering/2020/12/15/understanding-search-intent-with-better-recall/\"\n  }, \"Things Not Strings: Understanding Search Intent\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"DoorDash\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://arxiv.org/abs/1902.09041\"\n  }, \"Entity Personalized Talent Search with Tree Interaction Features\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"LinkedIn\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://engineering.fb.com/2017/03/29/data-infrastructure/faiss-a-library-for-efficient-similarity-search/\"\n  }, \"Faiss: A Library for Efficient Similarity Search\"), \" \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Facebook\"))));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"slug":"/resources/discovery-system-design/"}},
    "staticQueryHashes": ["3159585216","3897982121"]}